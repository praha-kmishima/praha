[2 E2Eテストについて考えてみよう](2%20E2Eテストについて考えてみよう.md)

← [1 E2Eテストを書いてみよう](1%20E2Eテストを書いてみよう.md) | [3 E2Eテストのクイズ](3%20E2Eテストのクイズ.md) →

---

## 2-1 E2E テストのメリットとデメリット

### メリット

- ユーザの振る舞い全体を想定して動作確認ができる
- 手動でやると工程が多く、時間がかかる確認作業でも自動化できる
- ログイン認証・ファイル入出力処理を行った結果どんな画面になるかなど、細かい条件分岐を持った処理でも対応可能

### デメリット

- 仕様変更でユーザの振る舞いが変わるとテストが使えなくなる
- テストが失敗した場合に、原因調査に時間がかかる場合がある
	- 本番動作に大きく影響があるものなら良いのだが、本来気にしなくてもよいような部分でエラーが出ているかもしれない
- 自動テストを組んだケース以外の観点で、本番環境でエラーが発生してしまう可能性もある

## 2-2 E2E でしかテストできないことを思いつく限り挙げてください

### ログイン・認証

- ユーザログインして、管理者ユーザーなら設定画面にアクセスできる
- ユーザログインして、30 分アクセスが無ければ再ログインさせる表示が出る
- 2 ファクタ認証で、メールアドレス登録後、スマートフォンに認証コードが送られ、Web 上にコードを入力するとログインできる

### ファイル操作

- ファイルをアップロードすると、データ読み込み処理が走って、完了するとアップロード済みファイルとしてファイル名がリストに表示される
- ファイルを削除すると、DB からデータが削除されて、リストから表示されなくなる
- 毎朝バッチ処理が走り、DB のバッチ処理ログテーブルに値が格納され、Web 上の最新更新時刻の表示が更新される

### 外部環境に依存する処理

- データ通信中に、オフライン環境になったとしても、再度オンライン環境になれば接続が復帰してちゃんと送信できる
- ある地図のポイントを指定して、その距離が原点から 30km より遠いと決定ボタンが disable になる
- 注文票の入力中に、閉店 30 分前の時間になると、入力できませんのメッセージが出て注文送信ができなくなる

### ユーザの振る舞い目線

- 「1度だけ」というステータスのメニューであれば、１度実行したあとは自動的に設定が OFF になる

### セキュリティ観点

- セキュリティ攻撃の可能性があるスクリプトが送られてきたときに適切な処置ができているか

## 2-3 テストを実装するにあたり、どういった基準で優先順位を決めていく？

個人的に考えたテスト実装の優先順位

テストの存在意義は、ソフトウェアを長く運用させていくための品質確保にあると思うので、１か月後、半年後、１年後・・・に対象コード部分を見直す必要が出たとき、自分はそのコードを見てどう感じるか？を意識しておくのが大事だと思う。

1. 不具合発生時のリスクがどれだけ高いか
	- エラーページが表示される可能性があるか
	- 間違った計算結果が表示されるか
	- 表示されてはいけないデータが表示されるか
	- セキュリティリスクがあるかどうか

2. 条件分岐があるかどうか
	- if 文の処理があるか？
	- 渡された引数の中身が null だったら？
	- 内部で呼び出している関数が null や例外を起こしたら？

3. 作業時間がどれだけ削減されるか
	- 確認作業の手間や、依存先の多い処理であるかどうかを考える
	- 毎回サンプルファイルを用意してアップロードして・・・などはやってられない

4. 書いたテストがどれだけ仕様変更に耐えられるか
	- 来週には不採用になるかもしれない実装部分なら書く必要はあまりない
	
