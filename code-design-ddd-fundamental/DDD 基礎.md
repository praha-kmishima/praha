## 課題１　DDD に関する用語について

| 用語            | 解説                                                                                                        |
| ------------- | --------------------------------------------------------------------------------------------------------- |
| エンティティ        | 一意の識別子を持つオブジェクト。状態が変化しても識別子によって同一性が保たれる。                                                                  |
| 値オブジェクト       | 識別子を持たないオブジェクト。プロパティの組み合わせによって同一性を示す。プロパティは不変。                                                            |
| 集約            | エンティティと値オブジェクトの集合。１つの集約を外部から変更する場合は、「集約ルート」を介して変更される。また、集約の境界はできるだけ小さく切っておくのがよい。                          |
| ユビキタス言語       | ドメインエキスパートとシステム開発者の共通言語。システム上のモデル変数名もそろえておく。                                                              |
| 境界付けられたコンテキスト | ユビキタス言語が有効な境界。境界が異なる場合、チームやシステムを分けることが推奨される（⇒マイクロサービス）。                                                   |
| ドメイン          | 「知識、影響力、活動の領域」を意味する。ソフトウェアが解決するべき問題領域やビジネスの範囲としても捉えられる。                                                   |
| ドメインサービス      | 複数オブジェクトをカプセル化するオブジェクト。エンティティや値オブジェクトだけでは表現できない場合に使う。                                                     |
| リポジトリ         | ドメインオブジェクトの永続化や取得のための抽象化レイヤー。実装に依存した設計にならないようにするため、リポジトリ層の実装はインターフェースへの依存が求められる                           |
| アプリケーション      | ドメインオブジェクトと、インフラ層の中間層。ユースケースを実現することが責務                                                                    |
| CQS           | メソッドを「状態を変更するコマンド」と「状態を返すクエリ」に分ける原則。                                                                      |
| CQRS          | CQS の拡張パターン。コマンド側とクエリ側でデータベースや、モデルを分離して扱うシステム。                                                             |
| DTO           | データベースや API などから取得したデータを受け取り、ドメインオブジェクトに変換するオブジェクト。                                                         |
| ドメインモデル貧血症    | 業務ロジックがアプリケーション層に集中していること。ドメイン層で表現できないビジネスルールをユースケース側で記載することで発生する。ドメインモデルのルールが複数個所に分散してしまい、修正容易性が下がってしまう。 |

## 課題 2-1 境界付けられたコンテキストの実例

- 「収支」の概念
	- 現業グループだと、今期売上額 - 今期の発生予定経費 = 収支 を表す
	- 経営グループだと、事業部別の各月締め日の受注状況と発生原価をもとにした、よりミクロな収支状況が収支を表す
	- （また、業種・会社によって捉え方も変わる）

## 課題 2-2 「Human」エンティティを作成してください

```ts
class Human2_2 {
    id: UUID
    bloodType: string
    birthday: Date
    name: string

    constructor(bloodType: string, birthday: Date, name: string) {
        this.id = randomUUID()
        this.bloodType = bloodType
        this.birthday = birthday
        this.name = name
    }    
}
```

## 課題 2-3 値オブジェクトを使わない場合のデメリットは？

- Human クラスに、各プロパティのバリデーション処理を実装することが必要になってしまう
- バリデーションのために DB アクセスが必要になる場合、外部層を呼び出す必要が出てくる
	- たとえば「名前が重複していないか？」を確認するとき
	- これは、オニオンアーキテクチャが定める依存の向きに違反するコードになってしまう

## 課題 2-4 値オブジェクトを使った実際のコード

以下に実装しました

[ddd-fundamental/src/2-4/human.ts](https://github.com/praha-kmishima/ddd-fundamental/blob/main/src/2-4/human.ts)

## 課題 3 ドメイン知識が漏れているコードのサンプル

以下に実装しました
- [ddd-fundamental/src/3/user.ts](https://github.com/praha-kmishima/ddd-fundamental/blob/main/src/3/user.ts)

処理のイメージ
- ドメイン層
	- User クラスがあります
	- User は、渡されたメールアドレスについて、組織外のアドレスかどうかをチェックします
- コントローラ層
	- UserController クラスがあります
	- UserController は、メールアドレスの変更処理ができます
	- メールアドレスを変更する手続きは、リポジトリ層に依頼して行われます
		- この際、「リポジトリ層に、重複するメールアドレスがないか」をチェックします
			- →これは、ドメイン知識がコントローラ層に漏れている

